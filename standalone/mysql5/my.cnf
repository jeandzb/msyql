[client]
default-character-set = utf8mb4

[mysql]
default-character-set = utf8mb4

[mysqld]
# --- 基础配置 ---
user            = mysql
port            = 3306
# 5.6 建议显式指定存储引擎
default-storage-engine = InnoDB
character-set-server = utf8mb4
collation-server     = utf8mb4_unicode_ci
skip-name-resolve

# --- 内存调优 (针对 4G 容器限制) ---
innodb_buffer_pool_size = 2G
innodb_buffer_pool_instances = 2
# 5.6 的元数据缓存设置
table_open_cache = 2000
table_definition_cache = 1000

# --- I/O & SSD 优化 ---
innodb_flush_method = O_DIRECT
innodb_io_capacity = 1000
# 5.6 建议关闭这个，SSD不需要
innodb_flush_neighbors = 0

# --- 日志 & 事务 ---
# 警告：修改此值需删除旧的 ib_logfile 文件后再启动
innodb_log_file_size = 512M
innodb_log_buffer_size = 16M
# 为了性能平衡，建议设为 2
innodb_flush_log_at_trx_commit = 2

# --- 兼容性与限制 ---
max_connections = 200
max_allowed_packet = 64M
# 解决 5.6 常见的“只有一行被更新”这类严格模式问题
sql_mode = NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES

# --- 慢查询记录 ---
slow_query_log = 1
long_query_time = 2
slow_query_log_file = /var/lib/mysql/slow.log

# --- 5.6 特有：显式记录 Binlog ---
# 您提到版本号带 -log，建议显式配置
log-bin = mysql-bin
server-id = 1
expire_logs_days = 7